{% extends 'FOSUserBundle::layout.html.twig' %}

{% block job_hunter %}
    <div class="block_search" ng-controller="searchCtrl">
      <div class="inner_block_search">
        <div class="search">
          <form class="">
            <button type="submit" name="button"></button>
            <input ng-model="query" type="search" name="" value="" placeholder="Recherche...">
            <div class="filter_by">

              <select class="" name="" ng-init = "selected = sltOptsSort[0]" ng-options = " select_opt.name for select_opt in sltOptsSort" ng-model = "selected">

              </select>
            </div>
          </form>
        </div>
          <div class="filter_block">
            <div class="form_filter">
                <form>
                    <div class="filter_group">
                        <div class="blfilter">
                            <label for="">Permis</label>
                            <select class="" name="">
                                <option value="">A</option>
                                <option value="">B</option>
                                <option value="">Poids Lourd</option>
                                <option value="">Moto</option>
                                <option value=""></option>
                            </select>
                        </div>
                        <div class="blfilter">
                            <label for="">QPV</label>
                            <select class="" name="">
                                <option value="">A</option>
                                <option value="">B</option>
                                <option value="">Poids Lourd</option>
                                <option value="">Moto</option>
                                <option value=""></option>
                            </select>
                        </div>
                        <div class="blfilter">
                            <label for="">RQTH</label>
                            <select class="" name="">
                                <option value="">Oui</option>
                                <option value="">Non</option>
                            </select>
                        </div>
                        <div class="blfilter">
                            <label for="">Genre</label>
                            <select class="" name="" ng-init = "genreSelect = genreSort[0]" ng-model = "genreSelect" ng-options = "genre.name for genre in genreSort">

                            </select>
                        </div>
                        <div class="blfilter">
                            <label for="">Métier</label>
                            <select class="" name="">
                                <option value="">Maçon</option>
                                <option value="">Plombier</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="spacer_filter"></div>
            <div class="toggle_filter">
              <span>Fermer le filtre de recherche</span>
            </div>
          </div>
        <div class="container_search">
          <div class="row_search">
            <div class="box">
              <span>prenom nom</span>
            </div>
            <div class="box">
              <span>info personnelle</span>
            </div>
            <div class="box">
              <span>qpv</span>
            </div>
            <div class="box">
              <span>id pole emploi</span>
            </div>
            <div class="box">
              <span>rqth</span>
            </div>
            <div class="box">
              <span>permis</span>
            </div>
            <div class="box">
              <span>métier</span>
            </div>
          </div>

          <div class="rows">
            <div class="row_item" ng-repeat= "data in jsonData | filter:selecTrie(selected, query)| filter : selectGenre(genreSelect)">
              <div class="group_detail">
                <div class="item_detail_name">
                  <span class="item_detail_span">{[{data.prenom+" "+data.nom}]}</span>
                </div>
                <div class="item_detail_infoperso">
                  <span class="genre">{[{data.genre|genreFilter}]}</span>
                  <span class="mail">{[{data.email}]}</span>
                  <span class="numb">Tel: {[{data.telPortable}]}</span>
                </div>
                <div class="item_detail_qpv">
                  <span class="item_detail_span">{[{data.QPVNom|qpvFilter}]}</span>
                </div>
                <div class="item_detail_rqth">
                  <span class="item_detail_span">{[{data.idPoleEmploi}]}</span>
                </div>
                <div class="item_detail_pemploi">
                  <span class="item_detail_span">{[{data.rqth|booleanFilter}]}</span>
                </div>
                <div class="item_detail_permis">
                  <span class="item_detail_span">{[{data.permisConduire|booleanFilter}]}</span>
                </div>
                <div class="item_detail_metier">
                  <span class="item_detail_span">{[{data.metier}]}</span>
                </div>
              </div>
              <div class="option_items">
                <div class="option_profil_show">
                  <a href="{[{data.id}]}">Voir</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="{{asset("js/angular.min.js")}}" charset="utf-8"></script>
    <script>
        var app = angular.module("appInter", []);
        app.config(function($interpolateProvider){
          $interpolateProvider.startSymbol('{[{').endSymbol('}]}');
        });

        /* Filtre pour remplacer  "F" => "Femme" & "H" => "Homme" */

        app.filter('genreFilter', function(){
            return function(input){
                var genre = {
                    F: "Femme",
                    H: "Homme",
                    A: "Autre"
                }
                var newGenre = genre[input];
                console.log(newGenre);
                return newGenre;
            }
        });

        app.filter('qpvFilter', function(){
            return function(input){
                var quartier = {
                    C: "Cleunay",
                    LB: "Le Blosne",
                    CM: "Les Cloteaux Champs Manceau",
                    M: "Maurepars",
                    V: "Villejean"
                }
                var newQpv = quartier[input];
                return newQpv;
            }
        });

        app.filter('booleanFilter', function(){
            return function(input){
                var boolean = {
                    true: "Oui",
                    false: "Non"
                }
                var newBoolean = boolean[input];
                return newBoolean;
            }
        });

        app.controller("searchCtrl", function($scope){

            //LISTE des données

            $scope.genreSort = [{
                value: "",
                name: "Tous"
            },{
                value: "F",
                name: "Femme"
            },{
                value: "H",
                name: "Homme"
            },{
                value: "A",
                name: "Autre"
            }];

            $scope.$watch("genreSelect", function(nouveau, old){
                console.log( nouveau);
                console.log( old);
            });

            $scope.sltOptsSort = [{
                    type: "select",
                    value: "nom",
                    name: "Par nom"
                },{
                    value: "prenom",
                     name: "Par prénom"
                 }];

            $scope.metierDb = [];

            var json = [];

            {% for demandeur in demandeurs %}
                var data =  {{demandeur|raw}};
                json.push(data);
            {% endfor %}

            /* Fonction tri */
            function trieByID(a,b){
                return a.id - b.id;
            }

            $scope.jsonData = json.sort(trieByID);

            /* Trier pour lister les métiers */

            for( i in $scope.jsonData){
                var item = $scope.jsonData[i].metier;

                if($scope.metierDb.length === 0 ){
                    console.log("ok");
                    console.log(item);
                    $scope.metierDb.push(item);
                }
                else{
                    for(var j = 0; j < $scope.metierDb.length; j++){
                        console.log('go!');
                        if( item !== $scope.metierDb[j] && item !== null){
                            $scope.metierDb.push(item);
                            console.log($scope.metierDb[j]);
                        }
                    }
                }
            }
            console.log($scope.metierDb);

            // FILTRE
            /* Filtre Pour chercher par nom ou par prénom */
            $scope.selecTrie = function( key, value ){
                var obj = {};
                obj[ "" + key.value + "" ] = value;
                return obj;
            };

            $scope.selectGenre = function( objGenre ){
                var obj = {};
                obj[ "genre" ] = objGenre.value;
                return obj;
            };
        });
    </script>
{% endblock %}
